<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTok Profile Growth Blueprint</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #111827;
}
.accordion-header::-webkit-details-marker, .settings-item summary::-webkit-details-marker {
display: none;
}
.accordion-header, .settings-item summary {
list-style: none;
}
.accordion-content {
border-left: 2px solid #374151;
}
details[open] .arrow {
transform: rotate(90deg);
}
.arrow {
transition: transform 0.2s ease-in-out;
}
::-webkit-scrollbar {
width: 8px;
}
::-webkit-scrollbar-track {
background: #1f2937;
}
::-webkit-scrollbar-thumb {
background: #4f46e5;
border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
background: #4338ca;
}
input:focus, textarea:focus, select:focus {
outline: none;
box-shadow: 0 0 0 2px #111827, 0 0 0 4px #4f46e5;
}
.spinner {
animation: spin 1s linear infinite;
}
@keyframes spin {
from { transform: rotate(0deg); }
to { transform: rotate(360deg); }
}
#ai_optimized_bio::placeholder {
color: #6b7280;
}
</style>
</head>
<body class="text-gray-200">

<div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-white tracking-tight">TikTok Profile Blueprint</h1>
        <p class="mt-2 text-lg text-gray-400">Stop guessing. Start engineering your growth.</p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-8">
        <div class="w-full bg-gray-700 rounded-full h-2.5">
            <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%; transition: width 0.5s ease-in-out;"></div>
        </div>
        <p id="progressText" class="text-center text-sm text-gray-400 mt-2">0% Complete</p>
    </div>

    <form id="worksheetForm" class="space-y-6">
        <!-- Part 1: First Impression Audit -->
        <details class="bg-gray-800 rounded-lg overflow-hidden" open>
            <summary class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Part 1: The 3-Second Audit</h2>
                <svg class="arrow w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="accordion-content p-5 ml-5 mt-2 space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">My profile picture is:</label>
                    <div class="space-y-2">
                         <label class="flex items-center p-3 bg-gray-700 rounded-md hover:bg-gray-600 cursor-pointer"><input type="radio" name="pfp" value="clear_face" class="h-4 w-4 mr-3 border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500"><span class="flex-1">A clear, high-quality photo of my face.</span></label>
                         <label class="flex items-center p-3 bg-gray-700 rounded-md hover:bg-gray-600 cursor-pointer"><input type="radio" name="pfp" value="logo" class="h-4 w-4 mr-3 border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500"><span class="flex-1">A logo for my brand/channel.</span></label>
                         <label class="flex items-center p-3 bg-gray-700 rounded-md hover:bg-gray-600 cursor-pointer"><input type="radio" name="pfp" value="other" class="h-4 w-4 mr-3 border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500"><span class="flex-1">Something else (meme, blurry photo, etc.).</span></label>
                    </div>
                </div>
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-300">My current username is:</label>
                    <input type="text" id="username" name="username" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 text-white" placeholder="@yourhandle">
                </div>
                <div>
                    <label for="goal" class="block text-sm font-medium text-gray-300">What is the SINGLE biggest goal of your TikTok profile?</label>
                    <input type="text" id="goal" name="goal" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 text-white" placeholder="e.g., Gain followers, sell a product, build a community">
                </div>
            </div>
        </details>

        <!-- Part 2: High-Conversion Bio -->
        <details class="bg-gray-800 rounded-lg overflow-hidden">
            <summary class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Part 2: The High-Conversion Bio</h2>
                 <svg class="arrow w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="accordion-content p-5 ml-5 mt-2 space-y-6">
                <div>
                     <label for="current_bio" class="block text-sm font-medium text-gray-300">A) The "Before" Snapshot: Paste your current bio</label>
                     <textarea id="current_bio" name="current_bio" rows="3" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 text-white" placeholder="Lover of coffee, travel, and good vibes..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">B) Draft Your Value Proposition:</label>
                    <div id="bio_draft_container" class="space-y-3 p-4 bg-gray-900 rounded-md">
                         <input type="text" id="draft_value" name="draft_value" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white" placeholder="What you provide (e.g., Daily marketing tips)">
                         <input type="text" id="draft_audience" name="draft_audience" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white" placeholder="Who it's for (e.g., for small business owners)">
                         <input type="text" id="draft_benefit" name="draft_benefit" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 text-white" placeholder="The result (e.g., to get more customers)">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">C) AI Bio Optimization:</label>
                    <div class="space-y-3">
                         <button type="button" id="optimizeBioButton" class="w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all duration-200">
                            <svg id="ai_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars mr-2" viewBox="0 0 16 16">
                                <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.3l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.3A1.734 1.734 0 0 0 2.31 4.207l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                            </svg>
                            <span id="ai_button_text">Optimize My Bio with AI</span>
                         </button>
                         <textarea id="ai_optimized_bio" name="ai_optimized_bio" rows="5" class="mt-1 block w-full bg-gray-900 border-gray-700 rounded-md shadow-sm p-3 text-white focus:ring-indigo-500 focus:border-indigo-500" placeholder="Your AI-optimized bio suggestions will appear here..."></textarea>
                    </div>
                </div>
            </div>
        </details>

        <!-- Part 3: Settings Check -->
        <details class="bg-gray-800 rounded-lg overflow-hidden">
            <summary class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Part 3: Settings Compliance Check</h2>
                 <svg class="arrow w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="accordion-content p-5 ml-5 mt-2 space-y-4">
                <!-- Setting 1 -->
                <details class="settings-item bg-gray-700 rounded-md">
                    <summary class="p-3 cursor-pointer flex items-center">
                        <input type="checkbox" name="settings_suggest" class="h-5 w-5 rounded border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500" onclick="event.stopPropagation()">
                        <span class="ml-3 text-gray-300 flex-1">Suggest Account to Others: OFF</span>
                        <svg class="arrow w-5 h-5 text-gray-400 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </summary>
                    <div class="p-4 border-t border-gray-600 text-sm">
                        <p class="font-semibold text-white">Why:</p>
                        <p class="text-gray-400 mb-2">This stops TikTok from wasting your crucial first views on friends and family who likely aren't your target audience. Better initial data for the algorithm means better reach.</p>
                        <p class="font-semibold text-white">How:</p>
                        <p class="text-gray-400">`Settings` &gt; `Privacy` &gt; `Suggest your account to others` &gt; Toggle OFF `Contacts` and `Facebook friends`.</p>
                    </div>
                </details>
                <!-- Setting 2 -->
                <details class="settings-item bg-gray-700 rounded-md">
                    <summary class="p-3 cursor-pointer flex items-center">
                        <input type="checkbox" name="settings_liked" class="h-5 w-5 rounded border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500" onclick="event.stopPropagation()">
                        <span class="ml-3 text-gray-300 flex-1">Liked Videos: Only Me</span>
                         <svg class="arrow w-5 h-5 text-gray-400 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </summary>
                     <div class="p-4 border-t border-gray-600 text-sm">
                        <p class="font-semibold text-white">Why:</p>
                        <p class="text-gray-400 mb-2">Maintains a professional appearance by keeping your liked videos private. You don't want potential partners or followers judging you by the random videos you've liked.</p>
                        <p class="font-semibold text-white">How:</p>
                        <p class="text-gray-400">`Settings` &gt; `Privacy` &gt; `Liked Videos` &gt; Select `Only me`.</p>
                    </div>
                </details>
                <!-- Setting 3 -->
                <details class="settings-item bg-gray-700 rounded-md">
                    <summary class="p-3 cursor-pointer flex items-center">
                        <input type="checkbox" name="settings_data" class="h-5 w-5 rounded border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500" onclick="event.stopPropagation()">
                        <span class="ml-3 text-gray-300 flex-1">Personalisation & Data: OFF</span>
                        <svg class="arrow w-5 h-5 text-gray-400 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </summary>
                    <div class="p-4 border-t border-gray-600 text-sm">
                        <p class="font-semibold text-white">Why:</p>
                        <p class="text-gray-400 mb-2">Limits TikTok's ability to track your activity across other apps and websites for ad targeting. Gives you more control over your personal data.</p>
                        <p class="font-semibold text-white">How:</p>
                        <p class="text-gray-400">`Settings` &gt; `Privacy` &gt; `Personalisation & Data` &gt; Toggle everything OFF.</p>
                    </div>
                </details>
                <!-- Setting 4 -->
                <details class="settings-item bg-gray-700 rounded-md">
                    <summary class="p-3 cursor-pointer flex items-center">
                         <input type="checkbox" name="settings_2fa" class="h-5 w-5 rounded border-gray-500 bg-gray-800 text-indigo-600 focus:ring-indigo-500" onclick="event.stopPropagation()">
                        <span class="ml-3 text-gray-300 flex-1">2-Step Verification: ON</span>
                        <svg class="arrow w-5 h-5 text-gray-400 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </summary>
                     <div class="p-4 border-t border-gray-600 text-sm">
                        <p class="font-semibold text-white">Why:</p>
                        <p class="text-gray-400 mb-2">Your best defense against getting hacked. As your account grows, it becomes a target. This makes it significantly harder for anyone to steal your hard work.</p>
                        <p class="font-semibold text-white">How:</p>
                        <p class="text-gray-400">`Settings` &gt; `Security` &gt; `2-Step Verification` &gt; Turn it ON.</p>
                    </div>
                </details>
            </div>
        </details>

        <!-- Part 4: Profile Power-Up -->
        <details class="bg-gray-800 rounded-lg overflow-hidden">
            <summary class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Part 4: Profile Power-Up Plan</h2>
                 <svg class="arrow w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="accordion-content p-5 ml-5 mt-2 space-y-8">
                 <div>
                    <h3 class="block text-lg font-bold text-gray-100 mb-3">A) Pinned Video Strategy</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="pin1" class="block text-sm font-medium text-gray-300">Pin 1: The "This Is Me" Pin</label>
                            <input type="text" id="pin1" name="pin1" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., A video that introduces your core topic in under 15 seconds.">
                        </div>
                         <div>
                            <label for="pin2" class="block text-sm font-medium text-gray-300">Pin 2: The "Pure Value" Pin</label>
                            <input type="text" id="pin2" name="pin2" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., Your most helpful tutorial or strongest piece of advice.">
                        </div>
                         <div>
                            <label for="pin3" class="block text-sm font-medium text-gray-300">Pin 3: The "Call to Action" Pin</label>
                            <input type="text" id="pin3" name="pin3" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., A video telling people to follow you on IG or check your link.">
                        </div>
                    </div>
                </div>
                 <div>
                    <h3 class="block text-lg font-bold text-gray-100 mb-3">B) Playlist Brainstorm</h3>
                    <div class="space-y-4">
                         <div>
                            <label for="playlist1" class="block text-sm font-medium text-gray-300">Playlist 1: For Beginners</label>
                            <input type="text" id="playlist1" name="playlist1" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., 'Start Here' or 'Fitness 101'">
                         </div>
                         <div>
                            <label for="playlist2" class="block text-sm font-medium text-gray-300">Playlist 2: Advanced Topics</label>
                            <input type="text" id="playlist2" name="playlist2" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., 'Pro-Level Tactics' or 'Level Up'">
                         </div>
                         <div>
                            <label for="playlist3" class="block text-sm font-medium text-gray-300">Playlist 3: Specific Results</label>
                            <input type="text" id="playlist3" name="playlist3" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md p-3 text-white" placeholder="e.g., 'Build Muscle' or 'Side Hustles'">
                         </div>
                    </div>
                </div>
            </div>
        </details>

        <!-- Part 5: Beyond TikTok -->
        <details class="bg-gray-800 rounded-lg overflow-hidden">
            <summary class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Part 5: The "Beyond TikTok" Bridge</h2>
                 <svg class="arrow w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="accordion-content p-5 ml-5 mt-2 space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">A) Link-in-Bio Setup (Beacons/Linktree)</label>
                    <input type="text" id="link_in_bio" name="link_in_bio" class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 text-white" placeholder="Paste your Linktree/Beacons URL here">
                </div>
                <div>
                    <label for="ig_idea" class="block text-sm font-medium text-gray-300">B) What's one specific way you can use Instagram to build community?</label>
                    <input type="text" id="ig_idea" name="ig_idea" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 text-white" placeholder="e.g., Use Close Friends for exclusive tips, run weekly Q&A stories">
                </div>
            </div>
        </details>
    </form>

    <!-- Analyze Button (now a Type=button to not submit form) -->
    <div class="mt-10">
        <button type="button" id="analyzeButton" class="w-full flex justify-center py-4 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all duration-200">
            Analyze My Blueprint
        </button>
    </div>
</div>

<!-- Modal -->
<div id="resultModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
        <div class="p-5 border-b border-gray-700 flex justify-between items-center">
            <h3 class="text-xl font-bold text-white">Your Growth Analysis</h3>
            <button id="closeModal" class="text-gray-400 hover:text-white">&times;</button>
        </div>
        <div id="modalContent" class="p-6 overflow-y-auto prose prose-invert prose-lg max-w-none">
            <div id="loadingSpinner" class="text-center">
                <svg class="animate-spin h-10 w-10 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-4 text-gray-300">Analyzing your blueprint...</p>
            </div>
            <div id="apiResponse"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('worksheetForm');
    const analyzeButton = document.getElementById('analyzeButton');
    const modal = document.getElementById('resultModal');
    const closeModalButton = document.getElementById('closeModal');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const apiResponseContainer = document.getElementById('apiResponse');

    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const allInteractiveElements = Array.from(form.querySelectorAll('input, textarea'));

    const optimizeBioButton = document.getElementById('optimizeBioButton');
    const aiButtonText = document.getElementById('ai_button_text');
    const aiIcon = document.getElementById('ai_icon');

    // Progress Bar Logic
    const updateProgress = () => {
        const simpleInputs = allInteractiveElements.filter(i => i.type !== 'radio' && i.type !== 'checkbox');
        const radioGroups = new Set(Array.from(form.querySelectorAll('input[type="radio"]')).map(r => r.name));
        const checkboxGroups = new Set(Array.from(form.querySelectorAll('input[type="checkbox"]')).map(r => r.name));

        const totalPotentialPoints = simpleInputs.length + radioGroups.size + checkboxGroups.size;

        let currentPoints = 0;
        simpleInputs.forEach(i => { if(i.value.trim() !== '') currentPoints++ });
        radioGroups.forEach(name => { if(form.querySelector(`input[name="${name}"]:checked`)) currentPoints++ });
        checkboxGroups.forEach(name => { if(form.querySelector(`input[name="${name}"]:checked`)) currentPoints++ });

        const percentage = totalPotentialPoints > 0 ? Math.round((currentPoints / totalPotentialPoints) * 100) : 0;

        progressBar.style.width = `${percentage}%`;
        progressText.textContent = `${percentage}% Complete`;
    };
    form.addEventListener('input', updateProgress);

    // AI Bio Optimizer
    optimizeBioButton.addEventListener('click', async () => {
        const draftValue = document.getElementById('draft_value').value.trim();
        const draftAudience = document.getElementById('draft_audience').value.trim();
        const draftBenefit = document.getElementById('draft_benefit').value.trim();

        if (!draftValue || !draftAudience || !draftBenefit) {
            alert('Please fill out all three fields in Section B to draft your bio first.');
            return;
        }

        aiButtonText.textContent = 'Optimizing...';
        aiIcon.classList.add('spinner');
        optimizeBioButton.disabled = true;

        const userDraft = `${draftValue} ${draftAudience} ${draftBenefit}`;
        const aiOptimizedBioTextarea = document.getElementById('ai_optimized_bio');
        aiOptimizedBioTextarea.value = 'Thinking of some stronger options...';

        const prompt = `
            Act as a world-class social media copywriter who specializes in creating high-impact, direct-response TikTok bios for a predominantly male audience. Your tone is sharp, authoritative, and focuses on tangible outcomes, not fluffy benefits.

            A user has drafted the following TikTok bio: "${userDraft}".

            Your task is to rewrite and optimize this bio. Return 3 distinct, improved versions. The versions should be short, powerful, and ready to be used on TikTok.
            Format the output as a numbered list.
        `;

        try {
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                 const errorBody = await response.text();
                 throw new Error(`API Error ${response.status}: ${errorBody}`);
            }

            const result = await response.json();

            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                const text = result.candidates[0].content.parts[0].text;
                aiOptimizedBioTextarea.value = text;
            } else {
                throw new Error("Invalid response structure from AI. The response may have been blocked for safety reasons.");
            }

        } catch (error) {
            console.error("Error optimizing bio:", error);
            aiOptimizedBioTextarea.value = `Sorry, there was an error generating ideas. ${error.message}`;
        } finally {
            aiButtonText.textContent = 'Optimize My Bio with AI';
            aiIcon.classList.remove('spinner');
            optimizeBioButton.disabled = false;
            updateProgress();
        }
    });

    // Modal Logic
    const openModal = () => modal.classList.remove('hidden');
    const closeModal = () => modal.classList.add('hidden');
    analyzeButton.addEventListener('click', async () => {
        openModal();
        loadingSpinner.style.display = 'block';
        apiResponseContainer.innerHTML = '';

        // Collect Data
        const data = {
            pfp: form.querySelector('input[name="pfp"]:checked')?.value || 'Not specified',
            username: document.getElementById('username').value,
            goal: document.getElementById('goal').value,
            current_bio: document.getElementById('current_bio').value,
            draft_value: document.getElementById('draft_value').value,
            draft_audience: document.getElementById('draft_audience').value,
            draft_benefit: document.getElementById('draft_benefit').value,
            ai_optimized_bio: document.getElementById('ai_optimized_bio').value,
            settings_suggest: document.querySelector('input[name="settings_suggest"]').checked,
            settings_liked: document.querySelector('input[name="settings_liked"]').checked,
            settings_data: document.querySelector('input[name="settings_data"]').checked,
            settings_2fa: document.querySelector('input[name="settings_2fa"]').checked,
            pin1: document.getElementById('pin1').value,
            pin2: document.getElementById('pin2').value,
            pin3: document.getElementById('pin3').value,
            playlist1: document.getElementById('playlist1').value,
            playlist2: document.getElementById('playlist2').value,
            playlist3: document.getElementById('playlist3').value,
            link_in_bio: document.getElementById('link_in_bio').value,
            ig_idea: document.getElementById('ig_idea').value,
        };

        const userBioDraft = `${data.draft_value} ${data.draft_audience} ${data.draft_benefit}`.trim();
        const finalBio = data.ai_optimized_bio || userBioDraft;

        const checkedSettings = [];
        if (data.settings_suggest) checkedSettings.push('Suggest Off');
        if (data.settings_liked) checkedSettings.push('Liked Private');
        if (data.settings_data) checkedSettings.push('Data Off');
        if (data.settings_2fa) checkedSettings.push('2FA On');
        const settingsSummary = checkedSettings.length > 0 ? checkedSettings.join(', ') : 'None';

        // Construct Prompt for Gemini
        const prompt = `
            Act as a world-class social media growth expert with a direct, no-nonsense, masculine tone.
            A creator has filled out a TikTok Profile Blueprint. Your task is to analyze their input and provide actionable, tactical feedback.
            Be critical but constructive. Focus on turning their ideas into a solid, executable growth strategy.
            Keep the feedback concise, using bullet points or short paragraphs. Address them directly as "you".

            Here is the creator's blueprint data:
            ---
            **Part 1: The 3-Second Audit**
            - Profile Picture Type: ${data.pfp}
            - Username: ${data.username || 'Not specified'}
            - Main Goal: ${data.goal || 'Not specified'}

            **Part 2: The High-Conversion Bio**
            - Current Bio: ${data.current_bio || 'Not specified'}
            - User's Drafted Bio: "${userBioDraft || 'Not drafted'}"
            - Final Bio Choice: "${finalBio || 'Not specified'}"

            **Part 3: Settings Compliance**
            - Settings Checked: ${settingsSummary}

            **Part 4: Profile Power-Up Plan**
            - Pin 1 Idea (Value): ${data.pin1 || 'Not specified'}
            - Pin 2 Idea (Hook): ${data.pin2 || 'Not specified'}
            - Pin 3 Idea (Next Step): ${data.pin3 || 'Not specified'}
            - Playlist 1 Idea: ${data.playlist1 || 'Not specified'}
            - Playlist 2 Idea: ${data.playlist2 || 'Not specified'}
            - Playlist 3 Idea: ${data.playlist3 || 'Not specified'}

            **Part 5: The "Beyond TikTok" Bridge**
            - Link-in-Bio URL: ${data.link_in_bio || 'Not specified'}
            - Idea for IG Community: ${data.ig_idea || 'Not specified'}
            ---

            Now, provide your expert analysis and recommendations based on this data. Pay close attention to their final bio choice and give feedback on its strength.
        `;

        // Gemini API (optional: replace with actual API call)
        try {
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                 const errorBody = await response.text();
                 throw new Error(`API Error ${response.status}: ${errorBody}`);
            }

            const result = await response.json();

            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                 let text = result.candidates[0].content.parts[0].text;
                let htmlResponse = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/^- (.*$)/gm, '<li class="mb-2">$1</li>')
                    .replace(/((<li>.*?<\/li>)+)/gs, '<ul>$1</ul>')
                    .replace(/\n\d\./g, '<br><br>$&')
                    .replace(/\n/g, '<br>');
                apiResponseContainer.innerHTML = htmlResponse;
            } else {
                 throw new Error("Invalid response structure from AI. The response may have been blocked for safety reasons or was empty.");
            }

        } catch (error) {
            console.error("Error fetching from Gemini API:", error);
            apiResponseContainer.innerHTML = `<p class="text-red-400">There was an error analyzing your blueprint. Please try again.</p><p class="text-xs text-gray-500 mt-2">${error.message}</p>`;
        } finally {
            loadingSpinner.style.display = 'none';
        }
    });

    closeModalButton.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
});
</script>

</body>
</html>
